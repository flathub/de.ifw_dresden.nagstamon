app-id: de.ifw_dresden.nagstamon
runtime: org.freedesktop.Platform
runtime-version: '18.08'
sdk: org.freedesktop.Sdk
command: nagstamon
finish-args:
  - --socket=wayland  
  - --socket=x11
  - --socket=pulseaudio
  - --share=network
  - --filesystem=~/.nagstamon:create
  - --talk-name=org.freedesktop.Notifications
modules:
  - name: cpython
    sources:
      - type: archive
        url: https://www.python.org/ftp/python/3.7.3/Python-3.7.3.tar.xz
        sha256: da60b54064d4cfcd9c26576f6df2690e62085123826cff2e667e72a91952d318
    build-options:
      build-args:
        - --share=network

  - name: deps
    buildsystem: simple
    build-commands:
      - pip3 install --no-index --find-links="file://${PWD}" --prefix=${FLATPAK_DEST}
        intreehooks setuptools_scm wheel beautifulsoup4 keyring lxml psutil requests requests-kerberos setuptools PyQt5 PyQt5-sip 
    build-options:
      build-args:
        - --share=network
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/ed/69/c805067de1feedbb98c53174b0f2df44cc05e0e9ee73bb85eebc59e508c6/setuptools-41.0.0.zip
        sha256: 79d30254b6fe7a8e672e43cd85f13a9f3f2a50080bc81d851143e2219ef0dcb1
      - type: file
        url: https://files.pythonhosted.org/packages/fb/9e/2e236603b058daa6820193d4d95f4dcfbbbd0d3c709bec8c6ef1b1902501/soupsieve-1.9.1.tar.gz
        sha256: b20eff5e564529711544066d7dc0f7661df41232ae263619dede5059799cdfca
      - type: file
        url: https://files.pythonhosted.org/packages/80/f2/f6aca7f1b209bb9a7ef069d68813b091c8c3620642b568dac4eb0e507748/beautifulsoup4-4.7.1.tar.gz
        sha256: 945065979fb8529dd2f37dbb58f00b661bdbcbebf954f93b32fdf5263ef35348
      - type: file
        url: https://files.pythonhosted.org/packages/7d/29/174d70f303016c58bd790c6c86e6e86a9d18239fac314d55a9b7be501943/lxml-4.3.3.tar.gz
        sha256: 4a03dd682f8e35a10234904e0b9508d705ff98cf962c5851ed052e9340df3d90
      - type: file
        url: https://files.pythonhosted.org/packages/2f/b8/11ec5006d2ec2998cb68349b8d1317c24c284cf918ecd6729739388e4c56/psutil-5.6.1.tar.gz
        sha256: fa0a570e0a30b9dd618bffbece590ae15726b47f9f1eaf7518dfb35f4d7dcd21
      - type: file
        url: https://files.pythonhosted.org/packages/06/b8/d1ea38513c22e8c906275d135818fee16ad8495985956a9b7e2bb21942a1/certifi-2019.3.9.tar.gz
        sha256: b26104d6835d1f5e49452a26eb2ff87fe7090b89dfcaee5ea2212697e1e1d7ae
      - type: file
        url: https://files.pythonhosted.org/packages/b1/53/37d82ab391393565f2f831b8eedbffd57db5a718216f82f1a8b4d381a1c1/urllib3-1.24.1.tar.gz
        sha256: de9529817c93f27c8ccbfead6985011db27bd0ddfcdb2d86f3f663385c6a9c22
      - type: file
        url: https://files.pythonhosted.org/packages/52/2c/514e4ac25da2b08ca5a464c50463682126385c4272c18193876e91f4bc38/requests-2.21.0.tar.gz
        sha256: 502a824f31acdacb3a35b6690b5fbf0bc41d63a24a45c4004352b0242707598e
      - type: file
        url: https://files.pythonhosted.org/packages/68/9e/49196946aee219aead1290e00d1e7fdeab8567783e83e1b9ab5585e6206a/pycparser-2.19.tar.gz
        sha256: a988718abfad80b6b157acce7bf130a30876d27603738ac39f140993246b25b3
      - type: file
        url: https://files.pythonhosted.org/packages/64/7c/27367b38e6cc3e1f49f193deb761fe75cda9f95da37b67b422e62281fcac/cffi-1.12.2.tar.gz
        sha256: e113878a446c6228669144ae8a56e268c91b7f1fafae927adc4879d9849e0ea7
      - type: file
        url: https://files.pythonhosted.org/packages/dd/bf/4138e7bfb757de47d1f4b6994648ec67a51efe58fa907c1e11e350cddfca/six-1.12.0.tar.gz
        sha256: d16a0141ec1a18405cd4ce8b4613101da75da0e9a7aec5bdd4fa804d0e0eba73
      - type: file
        url: https://files.pythonhosted.org/packages/fc/f1/8db7daa71f414ddabfa056c4ef792e1461ff655c2ae2928a2b675bfed6b4/asn1crypto-0.24.0.tar.gz
        sha256: 9d5c20441baf0cb60a4ac34cc447c6c189024b6b4c6cd7877034f4965c464e49
      - type: file
        url: https://files.pythonhosted.org/packages/ad/13/eb56951b6f7950cadb579ca166e448ba77f9d24efc03edd7e55fa57d04b7/idna-2.8.tar.gz
        sha256: c357b3f628cf53ae2c4c05627ecc484553142ca23264e593d327bcde5e9c3407
      - type: file
        url: https://files.pythonhosted.org/packages/fc/bb/a5768c230f9ddb03acc9ef3f0d4a3cf93462473795d18e9535498c8f929d/chardet-3.0.4.tar.gz
        sha256: 84ab92ed1c4d4f16916e05906b6b75a6c0fb5db821cc65e70cbd64a3e2a5eaae
      - type: file
        url: https://files.pythonhosted.org/packages/9a/b8/1ec56b6fa8a2e2a81420bd3d90e70b59fc83f6b857fb2c2c37accddc8be3/pykerberos-1.2.1.tar.gz
        sha256: 4f2dca8df5f84a3be039c026893850d731a8bb38395292e1610ffb0a08ba876c
      - type: file
        url: https://files.pythonhosted.org/packages/07/ca/bc827c5e55918ad223d59d299fff92f3563476c3b00d0a9157d9c0217449/cryptography-2.6.1.tar.gz
        sha256: 26c821cbeb683facb966045e2064303029d572a87ee69ca5a1bf54bf55f93ca6
      - type: file
        url: https://files.pythonhosted.org/packages/14/61/85737ebe1e65cd4bf023d9e4610df70851bd7638e003b81a44a9b901feae/requests-kerberos-0.12.0.tar.gz
        sha256: 9d21f15241c53c2ad47e813138b9aee4b9acdd04b82048c4388ade15f40a52fd
      - type: file
        url: https://files.pythonhosted.org/packages/16/1d/74adf3b164a8d19a60d0fcf706a751ffa2a1eaa8e5bbb1b6705c92a05263/jeepney-0.4.tar.gz
        sha256: 6089412a5de162c04747f0220f6b2223b8ba660acd041e52a76426ca550e3c70
      - type: file
        url: https://files.pythonhosted.org/packages/a6/89/df343dbc2957a317127e7ff2983230dc5336273be34f2e1911519d85aeb5/SecretStorage-3.1.1.tar.gz
        sha256: 20c797ae48a4419f66f8d28fc221623f11fc45b6828f96bdb1ad9990acb59f92
      - type: file
        url: https://files.pythonhosted.org/packages/b4/ef/063484f1f9ba3081e920ec9972c96664e2edb9fdc3d8669b0e3b8fc0ad7c/entrypoints-0.3.tar.gz
        sha256: c70dd71abe5a8c85e55e12c19bd91ccfeec11a6e99044204511f9ed547d48451
      - type: file
        url: https://files.pythonhosted.org/packages/b0/a0/0e161aaae24fd95258db01d3491202519c9b1b5a4c748ac163e078b9817f/keyring-19.0.1.tar.gz
        sha256: 44e5a4e1ad1070c7cd46959a0d6c2a99588b66a6dad6fd685463b486c04855ea
      - type: file
        url: https://files.pythonhosted.org/packages/98/61/fcd53201a23dd94a1264c29095821fdd55c58b4cd388dc7115e5288866db/PyQt5-5.12.1-5.12.2-cp35.cp36.cp37.cp38-abi3-manylinux1_x86_64.whl       
        sha256: d4e88208dfd017636e4b1f407990d0c3b6cf47afed6be4f2fb6ca887ef513e4b
      - type: file
        url: https://files.pythonhosted.org/packages/2e/ee/c6efd28dcb65e990411be50a46c9757f12202df94cfee73689223bbc2cf0/PyQt5_sip-4.19.15-cp37-cp37m-manylinux1_x86_64.whl
        sha256: 31a59f76168df007b480b9382256c20f8898c642e1394df2990559f0f6389f66
      - type: file
        url: https://files.pythonhosted.org/packages/b7/cf/1ea0f5b3ce55cacde1e84cdde6cee1ebaff51bd9a3e6c7ba4082199af6f6/wheel-0.33.1.tar.gz
        sha256: 66a8fd76f28977bb664b098372daef2b27f60dc4d1688cfab7b37a09448f0e9d
      - type: file
        url: https://files.pythonhosted.org/packages/54/85/514ba3ca2a022bddd68819f187ae826986051d130ec5b972076e4f58a9f3/setuptools_scm-3.2.0.tar.gz
        sha256: 52ab47715fa0fc7d8e6cd15168d1a69ba995feb1505131c3e814eb7087b57358
      - type: file
        url: https://files.pythonhosted.org/packages/35/35/da1123673c54b6d701453fcd20f751d6a1fae43339b3993ae458875576e4/pytoml-0.1.20.tar.gz
        sha256: ca2d0cb127c938b8b76a9a0d0f855cf930c1d50cc3a0af6d3595b566519a1013
      - type: file
        url: https://files.pythonhosted.org/packages/84/f4/5771e41fdf52aabebbadecc9381d11dea0fa34e4759b4071244fa094804c/docutils-0.14.tar.gz
        sha256: 51e64ef2ebfb29cae1faa133b3710143496eca21c530f3f71424d77687764274
      - type: file
        url: https://files.pythonhosted.org/packages/1f/87/9ea76ab4cdf1fd36710d9688ec36a0053067c47e753b32272f952ff206c5/flit-1.3.tar.gz
        sha256: 6f6f0fb83c51ffa3a150fa41b5ac118df9ea4a87c2c06dff4ebf9adbe7b52b36   
      - type: file
        url: https://files.pythonhosted.org/packages/f9/a5/5dacebf93232a847970921af2b020f9f2a8e0064e3a97727cd38efc77ba0/intreehooks-1.0.tar.gz
        sha256: 87e600d3b16b97ed219c078681260639e77ef5a17c0e0dbdd5a302f99b4e34e1

  - name: setup
    buildsystem: simple
    build-commands:
      - install -D nagstamon.sh /app/bin/nagstamon
      - install -Dm644 nagstamon-icon-64x64.png /app/share/icons/hicolor/64x64/apps/de.ifw_dresden.nagstamon.png
      - install -Dm644 nagstamon-icon-128x128.png /app/share/icons/hicolor/128x128/apps/de.ifw_dresden.nagstamon.png
      - install -Dm644 de.ifw_dresden.nagstamon.desktop -t /app/share/applications
      - install -Dm644 de.ifw_dresden.nagstamon.appdata.xml -t /app/share/metainfo
      - python3 setup.py install
    build-options:
      build-args:
        - --share=network
    sources:
      - type: git
        url: https://github.com/HenriWahl/Nagstamon.git
        tag: '3.2.1'
      - type: file
        path: de.ifw_dresden.nagstamon.desktop
      - type: file
        path: de.ifw_dresden.nagstamon.appdata.xml
      - type: file
        path: nagstamon-icon-128x128.png
      - type: file
        path: nagstamon-icon-64x64.png
      - type: file
        path: nagstamon.sh